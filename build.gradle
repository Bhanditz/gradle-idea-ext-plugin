plugins {
  id 'groovy'
  id 'java-gradle-plugin'
  id 'maven'
  id "org.jetbrains.kotlin.jvm" version "1.1.50"
}

group = 'org.jetbrains.gradle.plugin.idea-ext'
version = '0.1-SNAPSHOT'

repositories {
  mavenCentral()
}

dependencies {
  compile 'org.jetbrains.kotlin:kotlin-stdlib'
  testCompile('org.spockframework:spock-core:1.1-groovy-2.4') {
    exclude module: 'groovy-all'
  }
}

gradlePlugin {
  plugins {
    ideaExtPlugin {
      id = "org.jetbrains.gradle.plugin.idea-ext"
      implementationClass = "org.jetbrains.gradle.ext.IdeaExtPlugin"
    }
  }
}


tasks.compileGroovy {
  options.encoding = 'UTF-8'
  doFirst {
    classpath = classpath + project.files(tasks.compileKotlin.destinationDir)
  }

  doLast {
    classpath = classpath - project.files(tasks.compileKotlin.destinationDir)
  }
}

tasks.compileTestGroovy {
  options.encoding = 'UTF-8'
  doFirst {
    classpath = classpath + project.files(tasks.compileTestKotlin.destinationDir)
  }

  doLast {
    classpath = classpath - project.files(tasks.compileTestKotlin.destinationDir)
  }
}
